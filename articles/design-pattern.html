<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="forestly">
<title>Design Plan of R Package forestly • forestly</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Design Plan of R Package forestly">
<meta property="og:description" content="forestly">
<meta property="og:image" content="https://merck.github.io/forestly/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">forestly</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/forestly.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/forest-plot-static.html">Static Forest Plot</a>
    <a class="dropdown-item" href="../articles/layout.html">Controlling Layout</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/index.html">More articles...</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/Merck/forestly/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Design Plan of R Package forestly</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Merck/forestly/blob/HEAD/vignettes/design-pattern.Rmd" class="external-link"><code>vignettes/design-pattern.Rmd</code></a></small>
      <div class="d-none name"><code>design-pattern.Rmd</code></div>
    </div>

    
    
<blockquote>
<p>This document is for developers who would like to understand the
internal of the forestly package.</p>
</blockquote>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The forestly package is developed to generate interactive forest plot
for the safety analysis in clinical trials.</p>
<p>To generate an interactive forest plot, we develop three main
functions as listed below. And the details of these three main functions
will be introduced in the next three sections separately.</p>
<ul>
<li>
<code>tidy_ae_table</code>: This function is used to obtain adverse
event (AE) information ready for visualization.</li>
<li>
<code>download_ae_reports</code>: This function is used to generate
a download button, so users can download the AE summary tables by
clicking this button.</li>
<li>
<code>forestly</code>: This function is used to generate an
interactive forest plot.</li>
</ul>
<p>A minimal example summarized the major steps in using the forestly
package is</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mydata</span> <span class="op">&lt;-</span> <span class="fu">tidy_ae_table</span><span class="op">(</span><span class="va">...</span><span class="op">)</span>    <span class="co"># Step 1: create tidy AE data</span></span>
<span><span class="fu">download_ae_reports</span><span class="op">(</span><span class="va">mydata</span><span class="op">)</span>     <span class="co"># Step 2: generate download button</span></span>
<span><span class="fu">forestly</span><span class="op">(</span><span class="va">mydata</span><span class="op">)</span>                <span class="co"># Step 3: generate interactive forest plot</span></span>
<span>                                <span class="co"># (the order of Step 2 and Step 3 can be reversed)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="main-function-1-tidy_ae_table">Main function 1: <code>tidy_ae_table()</code><a class="anchor" aria-label="anchor" href="#main-function-1-tidy_ae_table"></a>
</h2>
<p>The main function <code>tidy_ae_table()</code> is used to obtain AE
information ready for visualization. Specifically speaking, it merges
standardized <code>adsl</code> and <code>adae</code> tables together,
and outputs a AE summary table. The AE summary table summarizes the
number/ratio of subjects experiencing a certain AE for both treatment
arm and control arm.</p>
<p>There are some utility functions developed inside of
<code>tidy_ae_table()</code> and we list them as follows.</p>
<ul>
<li><p><code>tidy_population()</code>: This function is used to prepare
the observation datasets for the use in function
<code>tidy_ae_table()</code>. The function filter the <code>adsl</code>
dataset, and define the proper treatment order in the dataset.</p></li>
<li><p><code>tidy_observation()</code>: This function is used to prepare
the observation datasets for the use in function
<code>tidy_ae_table()</code>. The function filter the <code>adae</code>
dataset, and define the proper treatment order in the dataset.</p></li>
<li><p>`<code>prop_test_mn()</code>: This function tests equal
proportion using Miettinen and Nurminen method. In the
<code>forestly</code> package, it generates the confidence interval (CI)
for the risk difference between treatment arm and control arm.</p></li>
<li><p><code>define_ae_selectList()</code>: This function is to specify
the AE labels to be displayed in the select list of the interactive
forestly plot. It has two arguments, (1) <code>ae_criterion</code> and
(2) <code>ae_label</code>. The first argument <code>ae_criterion</code>
is a (vector of) string, which defines the criterion to select a class
of AE to display in the interactive forest plot. For example, if
<code>ae_criterion = 'AESER == "Y"'</code>, then it will select the
serious AE. The second argument <code>ae_label</code> is a (vector of)
string, which defines the labels to be displayed in the select list of
interactive forest plot. If these two arguments are both string vectors,
then they must be a 1:1 map. This function is used in the arguments
<code>ae_interested =</code> in function <code>tidy_ae_table()</code>
(see examples below). It throws errors if the length of the
<code>ae_criterion</code> doesn’t match that of
<code>ae_label</code>.</p></li>
</ul>
<pre><code># Example 1: if you would like to display the serious AE
tidy_ae_table(...,
              ae_interested = define_ae_selectList(ae_criterion = 'AESER == "Y"',
                                                   ae_label = "serious AE"),
              ...).

# Example 2: if you would like to display both serious AE and drug-related AE
tidy_ae_table(...,
              ae_interested = define_ae_selectList(ae_criterion = c('AESER != "N"', 'AEREL != "None"'),
                                                   ae_label = c("serious AE", "drug-related AE")
              ...).</code></pre>
<ul>
<li><p><code>tidy_multi_ae_label()</code>: This a function is design to
<code>rbind</code> data together according to the interested AE labels
defined in <code>ae_interested =</code>. For example, if you use Example
1 above, <code>tidy_multi_ae_label()</code> will generate an AE summary
table as rbind(summary table of all AE, summary of serious AE).</p></li>
<li><p><code>tidy_ae_listing()</code>: This function generates a data
frame which serves as the listed details in the the reactable.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="main-function-2-tlf_download">Main function 2: <code>tlf_download()</code><a class="anchor" aria-label="anchor" href="#main-function-2-tlf_download"></a>
</h2>
<p>This function generates a download button for users to download AE
tables.</p>
<ul>
<li>
<code>tlf_ae_summary</code>: a function to create AE summary table.
<ul>
<li>Example: <a href="https://merck.github.io/r2rtf/articles/example-ae-summary.html" class="external-link uri">https://merck.github.io/r2rtf/articles/example-ae-summary.html</a>
</li>
</ul>
</li>
<li>
<code>tlf_ae_specific</code>: a function to create specific AE
table.</li>
<li>
<code>tlf_ae_listing</code>: a function to create AE listing.</li>
</ul>
<p>The output of the <code>tlf_xxx</code> functions are
<code>r2rtf</code> objects created by <code>rtf_encode</code></p>
<ul>
<li>
<code>tlf_download</code>: a function to download multiple TLFs in
Rmarkdown. Rewrite <code>ae_download_report</code> to allow it use
<code>tlf_xxx</code> functions as input.</li>
</ul>
<pre><code><span><span class="fu">tlf_ae_summary</span><span class="op">(</span><span class="op">)</span>   <span class="co"># generate the AE summary table</span></span>
<span><span class="fu">tlf_ae_specific</span><span class="op">(</span><span class="op">)</span>  <span class="co"># generate the specific AE table</span></span>
<span><span class="co"># tlf[[4]] &lt;- tlf_ae_listing()   # As needed ????</span></span>
<span></span>
<span><span class="fu">tlf_download</span><span class="op">(</span><span class="op">)</span>    <span class="co"># download the above tables</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="main-function-3-forestly">Main function 3: <code>forestly()</code><a class="anchor" aria-label="anchor" href="#main-function-3-forestly"></a>
</h2>
<p>This function generates an interactive forest plot for the returned
objected of <code>tidy_ae_table()</code>. For this interactive forstly
plot, it consists two blocks.</p>
<p>The first block is a select list. The items listed in the select list
is specified by the <code>ae_label =</code> in function
<code>tidy_ae_table(..., ae_interested = , ...)</code>. By clicking
different AE labels, different reactable will be generated. For example,
if you click “serious AE”, then the reactable will only display the
serious AE summary table. The main tool to develop this block is
<code><a href="https://rdrr.io/pkg/crosstalk/man/filter_select.html" class="external-link">crosstalk::filter_select()</a></code>.</p>
<p>The second block is a reactable. The reactable summarizes the AE
information under the selected AE label. The main tool to develop this
block is <code><a href="https://glin.github.io/reactable/reference/reactable.html" class="external-link">reactable::reactable()</a></code>.</p>
<p>There are some utility functions used to develop
<code>forestly()</code> and we listed them as follows.</p>
<ul>
<li>
<p><code>forestly_design_details()</code>: This function returns the
design details of the reactable in the forest plot, including</p>
<ul>
<li>the design details of the cell of the two proportions;</li>
<li>the design details of the cell of the CI;</li>
<li>the design details of the footer of the two proportions;</li>
<li>the design details of the footer of the CI.</li>
</ul>
<p>These design details are returned by another utility function
<code>sparkline_point_js()</code>, and we will introduce its details
later.</p>
<p>To generate the above design details, users need to specify the
elements for the design, including</p>
<ul>
<li>color: the color for the two proportion/CI plot (see arguments
<code>fig_prop_color =</code> and <code>fig_diff_color =</code>);</li>
<li>label: the labels to be displayed under the two proportion/CI plot
(see arguments <code>fig_prop_label =</code> and
<code>fig_diff_label =</code>);</li>
<li>column width: the column width of the two proportion/CI plot (see
arguments <code>fig_prop_colwidth =</code> and
<code>fig_diff_colwidth =</code>);</li>
<li>range: the x-axis range to plot the two proportion/CI plot (see
arguments <code>fig_prop_range =</code> and
<code>fig_diff_range =</code>).</li>
</ul>
</li>
<li><p><code>sparkline_point_js()</code>: This function generates a
Javascript to be rendered. It is used for the design details of
reactables, including both the cell and the footer. It has dependence to
the files under path
<code>forestly/inst/js/sparkline.js</code>.</p></li>
<li><p><code>mk_reactable()</code>: This function is used to create a
data table from tabular data with sorting and pagination by default.
Essentially, it is a wrapper of function <code>reactable()</code> for
robust BAAMR usage. It has dependence to R package
<code>reactable</code>.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="other-utility-filesfunctions">Other utility files/functions<a class="anchor" aria-label="anchor" href="#other-utility-filesfunctions"></a>
</h2>
<ul>
<li>
<code>important_functions.R</code>: This is used to declare the
R-package dependency of the functions we used to develop the above
functions.</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Yilong Zhang, Benjamin Wang, Yujie Zhao. Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9. <br>Copyright © 2023 Merck &amp; Co., Inc., Rahway, NJ, USA and its affiliates. All rights reserved.</p>
</div>

<div class="pkgdown-footer-right">
  <p><span></span></p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
